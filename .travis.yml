language: node_js
sudo: required
notifications:
  email: false
  slack:
    rooms:
      - secure: juuizlfiQolXbqy4L2nfODB1K8xiSGvUrzsT3XeXIsQqX7yCYVvnRUssKLbqgLM9m85kgXJk1ef0qwjJoliNqGcrALTZLHPTkxWwTnV7tPEVS/4uQPSyy+DDHDwrTzCrF3qhCqyKJ6vB18z22qm3qLgStmNj4p1ZLznsdJR/u7U3spJ+WLL70QSNHCQy/5QjRDDiR3oqWdXjhVcUCeV+v/2CtfqK3dqYtzCL/b7z8lm/YbV6w1Rd8mwzTgLstbzjrvR/gq2IPALzzJTq1S8lXtV7ZtbYz4bjB8RNCRZFJrjBUH4CqD1oUskit4RRe+ilVs8qNQh0Tt3whsOdbJoRXJn2B/NVxppp2WGlODdsuMgfNh5iBocHKN3Qo4mONbstnHFG99Hr7L8GbUugJHEQlrZn1xRyO9ulyVp+hFp8/F088NNyhnd3+lERUPA5/4+HPQh6Ea+PyKq2TR41VoDGcRDBS4VY/6PfLEJzxEBjwRAAemfvtOFTUu2EocuAllPX1vMA4b1j7Wm+Bs7wft6nEcVdftVanfAgx4dNksnaS8zN9II8rdtBci2yXYJ6J+e+REDn/2IrHaUwr0N9BojYc0ePUElDcygW4Kk1oGklHp681j2zhi1Gt7rbuae1C9fD4QHnryx59uVH5NXqDsXI5EbwTJE3zvzRz9SzmyDqV5A=
node_js:
- '10'
install:
- npm ci
jobs:
  include:
  - stage: Deploy cloud.redhat.com
    script: npm run deploy && curl -sSL https://raw.githubusercontent.com/RedHatInsights/insights-frontend-builder-common/master/src/bootstrap.sh | bash -s
    if: tag IS blank
  - stage: Standalone release
    if: tag IS NOT blank
    before_deploy:
      - npm run build-standalone
      - mv dist/ automation-hub-ui-dist/
      - tar -czvf automation-hub-ui-dist.tar.gz automation-hub-ui-dist/
    deploy:
      provider: releases
      file: automation-hub-ui-dist.tar.gz
      skip_cleanup: true
      api_key:
        secure: "RlS9bPvhWHRq3YYsVYSNqu79jnXJ2T3VsCvogJ2XlF5D4oBPTdDOCxIjcERGUMtZKqrnu3NBW3gjL4OnMk3OEux5jCtznsb3imEnmeDfwpWba8hzrNIWlu3zlA5voIy4wU3GhsDNyFNm8TFIxZ4uC0zAYzMBgnpBGKVt2scCitpEbWsZmlyGbkwRD6QHAiMSI6rJuBlUMPR/Grzi2pCojK6TImLu3tIL632Xgvo/lorI0qX0Gr9wvA6qUZSKkN6N1hmavha4RvRa1MvLSQ7gf8Y+7Bsf798sblRvTGdBvMvjmHjJL98Ed5UCQWp6evw4YH3utSYjh+WrlIeTy9AN5qh/jL4xeowhU+DYIQp5By66qmDfENA43W3nHC7miJ9ewSF4HYPwIL2hER72lvJboXfDJsFovSF4pEpTGhcLWm1LoCS+w+KmOUI6Wm1xtA0hAtFEgXPn+FyqPJUyLItLBKLFbGB68kFD5P4Bw9MhD2AM7fQieRwDpkSDCgU96mu91aT/sGOQtsH/F6x3INOsXcl+4Ztjdy1S/1nsm4NsVpNoesVaBx33XCEB914QkCmMSXC7EJ39IVQBXCI91WoERDSQet+Gpa2+iLUV9351S7S3L/ViFKzZjH1fojlBxKbfwujKslQNdjYG4GMjQdIgmydXRfPQMg9VlFzdWcDr1yY="
      on:
        tags: true
env:
  global:
  - REPO="git@github.com:RedHatInsights/ansible-hub-ui-build.git"
  - REPO_DIR="ansible-hub-ui-build"
  - BRANCH=${TRAVIS_PULL_REQUEST_BRANCH:-$TRAVIS_BRANCH}
  - NODE_OPTIONS="--max-old-space-size=4096 --max_old_space_size=4096"
